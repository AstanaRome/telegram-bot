# Tomorrow School Telegram Bot

Простой бот, который считает время учебных сессий за календарную неделю (понедельник – воскресенье) и показывает статистику. Данные живут в PostgreSQL, поэтому не пропадают после рестартов Railway.

## Что нужно

- Python 3.10+ (на Railway фиксируем через `runtime.txt`)
- Токен Telegram-бота из [@BotFather](https://t.me/BotFather)
- Установка зависимостей: `pip install -r requirements.txt`
- Переменные окружения:
  - `TELEGRAM_BOT_TOKEN` — токен бота
  - `DATABASE_URL` — строка подключения к PostgreSQL (`postgresql://user:pass@host:port/db`)
  - `BOT_TIMEZONE` — (опционально) часовой пояс, по умолчанию `Asia/Almaty` (Астана)

## Возможности

- Клавиатура с кнопками «Начать сессию», «Закончить сессию», «Статистика недели», «Текущая сессия»
- Учёт длительности каждой сессии с точностью до секунд
- Хранение данных в таблице `sessions` в PostgreSQL
- Авто‑завершение сессии, если пользователь забыл нажать стоп перед новым стартом
- Подсчёт времени только в рамках текущей недели (пон-Вс) + подробный список сессий недели в статистике
- Отдельная кнопка «Текущая сессия» показывает сколько длится активный таймер

## Запуск

```bash
export TELEGRAM_BOT_TOKEN=...
export DATABASE_URL=postgresql://...
python bot.py
```

### Railway шпаргалка

1. Залей код в GitHub.
2. В Railway создай проект → “Deploy from GitHub repo”.
3. Добавь сервис “PostgreSQL” и скопируй его `Postgres Connection URL`.
4. В Variables сервиса приложения задай:
   - `TELEGRAM_BOT_TOKEN`
   - `DATABASE_URL` (значение из предыдущего шага)
   - `PYTHON_VERSION=3.11`
5. В репозитории уже есть `runtime.txt`, поэтому Railway соберёт окружение на Python 3.11. Команда запуска — `python bot.py`.
6. После деплоя смотри логи: бот должен написать, что начал polling.

## Дальнейшие улучшения

- Добавить полноценную админку/отчёты за произвольный период и экспорт в XLSX/CSV
- Интегрировать авторизацию/привязку к ученикам Tomorrow School
- Перейти на вебхуки и autoscale (например, Railway → Render → Fly)
- Реализовать напоминания о незакрытых сессиях через scheduled jobs/webhooks
